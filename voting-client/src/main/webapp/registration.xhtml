<!--
/*
 * Copyright (c) 2014 Berner Fachhochschule, Switzerland.
 * Bern University of Applied Sciences, Engineering and Information Technology,
 * Research Institute for Security in the Information Society, E-Voting Group,
 * Biel, Switzerland.
 *
 * Project UniCert.
 *
 * Distributable under GPL license.
 * See terms of license at gnu.org.
 */
-->
<ui:composition template="template.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="page_title">#{msg.title}</ui:define>

	<ui:define name="head_include_js">
		<script type="text/javascript" src="js/lib/leemon.js"></script>
		<script type="text/javascript" src="js/lib/sha256.js"></script>
		<script type="text/javascript" src="js/lib/aes.js"></script>
		<script type="text/javascript" src="js/lib/pbkdf2.js"></script>
		<script type="text/javascript" src="js/univote-util.js"></script>
		<script type="text/javascript" src="js/univote-random.js"></script>
		<script type="text/javascript" src="js/univote-crypto.js"></script>
		<script type="text/javascript" src="js/registration.js"></script>
	</ui:define>

	<ui:define name="content">

		<form name="properties">
			<input type="hidden" id="requester-id" value="#{param.id}"/>
			<input type="hidden" id="requester-email" value="#{param.mail}"/>
			<input type="hidden" id="requester-idp" value="#{param.idp}"/>
			<input type="hidden" id="paramset" value="#{param.params}"/>
		</form>

		<div class="row">
			<div class="small-12 columns">
				<h3>#{msg.certrequest}</h3>
			</div>
			<div class="large-4 medium-4 columns">
				<button id="step_1" class="arrow_box grey" tabindex="-1">#{msg.genkeysStep1}</button>
			</div>
			<div class="large-4 medium-4 columns">
				<button id="step_2" class="arrow_box grey active" tabindex="-1">#{msg.genkeysStep2}</button>
			</div>
			<div class="large-4 medium-4 columns">
				<button id="step_3" class="arrow_box grey" tabindex="-1">#{msg.genkeysStep3}</button>
			</div>
		</div>

		<!-- STEP 2: Generation key content -->
		<div id="step_2_content">
			<div class="row">
				<div class="small-12 columns">
					<p>#{msg.genkeysStep2Text}</p>
				</div>
			</div>
			<form onsubmit="return false;">

				<div id="substep_2_1" class="row substep active done">
					<div class="large-4 medium-4 columns chooser">
						<h1>1.</h1>
						<p>#{msg.genkeysSubstep21Text}</p>
					</div>
					<div class="large-8 medium-8 columns chooser_content">
						<select id="setup" class="select radius" name="setup" size="1" onchange="updateSetup()">
							<!-- TODO Get values from JNDI -->
							<option value="">#{msg.pleaseSelect}</option>
							<option value="manually">#{msg.manually}</option>
							<option value="uv-vsbfh">VSBFH</option>
						</select>
						<div id="manual_setup" class="hidden">
							<select id="crypto_setup_type" class="select radius" name="crypto_setup_type" size="1" onchange="updateKeysOptions()">
								<option value="">#{msg.pleaseSelectOption}</option>
								<option value="RSA">RSA</option>
								<option value="DiscreteLog">Discrete Logarithm</option>
							</select>
							<div id="rsa_options" class="crypto_setup_type_options hidden">
								<p class="col1 small">#{msg.keysize}</p>
								<select id="crypto_setup_size" class="select" name="crypto_setup_size" size="1">
									<option value="1024">1024</option>
									<option value="2048">2048</option>
								</select>
							</div>
							<div id="dlog_options" class="crypto_setup_type_options hidden">
								<p class="col1 small">#{msg.valuep}</p>
								<input type="text" id="p" />
								<p>#{msg.valueq}</p>
								<input type="text" id="q" />
								<p>#{msg.valueg}</p>
								<input type="text" id="g" />
							</div>
							<div>
								<p>#{msg.application}</p>
								<input type="text" id="application"/>
							</div>
							<div>
								<p>#{msg.role}</p>
								<input type="text" id="role"/>
							</div>
							<div>
								<p>#{msg.identityFunction}</p>
								<select id="identity_function" class="select" name="identity_function" size="1">
									<option value="1">#{msg.idFStandardSwitch}</option>
									<option value="2">#{msg.idFAnonymizedSwitch}</option>
									<option value="3">#{msg.idFZurichSwitch}</option>
									<option value="4">#{msg.idFStandardGoogle}</option>
									<option value="5">#{msg.idFAnonymizedGoogle}</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div id="substep_2_2" class="row substep">
					<div class="large-4 medium-4 columns chooser">
						<h1>2.</h1>
						<p>#{msg.genkeysSubstep22Text}</p>
					</div>
					<div class="large-8 medium-8 columns chooser_content">
						<button id="generate_key_bu" class="button radius gradient icon-right-dir" disabled="disabled" onclick="generateKeyPair();">#{msg.genkeysButton}</button>
						<div id="substep_2_2_1">
							<p>#{msg.yourVotingKeyLabel}</p>
							<textarea id="secretkey_ta" class="middle radius" disabled="disabled" readonly="readonly"></textarea>
						</div>
					</div>
				</div>

				<div id="substep_2_3" class="row substep">
					<div class="large-4 medium-4 columns chooser">
						<h1>3.</h1>
						<p>#{msg.genkeysSubstep23Text}</p>
					</div>
					<div class="large-8 medium-8 columns chooser_content">
						<div>
							<p>#{msg.password}</p>
							<div><input type="password" name="password" id="password" disabled="disabled"/> <span id="pwderror"></span></div>
						</div>
						<div>
							<p>#{msg.retypePassword}</p>
							<div><input type="password" name="password2" id="password2" disabled="disabled"/><img id="password-check-icon" src="img/check.png" /></div>
						</div>
					</div>
				</div>

				<div id="substep_2_4" class="row substep">
					<div class="large-4 medium-4 columns chooser">
						<h1>4.</h1>
						<p>#{msg.genkeysSubstep24Text}</p>
					</div>
					<div class="large-8 medium-8 columns chooser_content">
						<div id="alt_mail" class="hidden">
							<span class="small">#{msg.andText} </span><input type="text" id="alternate_mail" value="#{msg.optionalMail}"/>
						</div>
						<button id="retreive_secretkey_bu" class="button radius gradient icon-right-dir" disabled="disabled" onclick="completeCertRequest(true);">#{msg.retreiveSecretKey} #{msg.to}</button>
					</div>
					<c:if test="${initParam['dev-mode'] == 'true'}">
						<br /><br/><span class="tiny">In dev-mode: <br/>if you don't have a running SMTP Server on your localhost...<br/>
							<button class="button" onclick="completeCertRequest(false);">Save Key</button></span>
					</c:if>
				</div>

			</form>
		</div>


		<!-- STEP 3: Confirmation content -->
		<div id="step_3_content" class="hidden">
			<div class="row">
				<div class="small-12 columns">
					<p class="center"><img src="img/check_big.png" /></p>
					<p>#{msg.regsuccess}</p>
					<p>#{msg.inspectcert}</p>
					<p class="center"><button class="button radius gradient icon-right-dir" onclick="inspectCert();">#{msg.savecert}</button></p>

					<p class="spacer50">
						<h:outputLink value="index.xhtml" class="red icon-right-dir">#{msg.backhome}</h:outputLink>
					</p>
				</div>
			</div>
		</div>

	</ui:define>

</ui:composition>
